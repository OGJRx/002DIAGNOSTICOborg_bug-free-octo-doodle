Entendido. Hemos alcanzado un excelente punto de parada por hoy.

**Resumen del Estado Actual y Documentación Actualizada:**

Hemos completado una fase de implementación y refactorización significativa. El estado actual del proyecto se refleja ahora de manera precisa en los siguientes archivos informativos clave:

1.  **`README.md`:** Ha sido completamente reescrito y ahora sirve como una guía integral y profesional orientada a DevOps. Documenta:
    *   Las capacidades actuales y el potencial de despliegue del bot (`/agendar`, `/estado`, `/cotizar`).
    *   Una guía de despliegue paso a paso para Vercel.
    *   La configuración de variables de entorno críticas (`TELEGRAM_BOT_TOKEN`, `POSTGRES_URL`, `STAFF_IDS`).
    *   La automatización de CI/CD para el webhook, que elimina la necesidad de configuración manual post-despliegue.
    *   Las medidas de seguridad y rendimiento implementadas.

2.  **`api/schema.sql`:** Este nuevo archivo contiene el esquema definitivo y ejecutable de la base de datos PostgreSQL, sirviendo como la "fuente de la verdad" para la estructura de la base de datos, un artefacto esencial para cualquier despliegue.

3.  **Código Fuente (`api/_bot.ts`, `api/_db.ts`):** El código ha sido actualizado para reflejar el esquema SQL, implementar la lógica de los comandos, y reforzar la seguridad y el manejo de errores.

**Potenciales Próximos Pasos para la Siguiente Sesión:**

Basado en el estado actual y los objetivos del proyecto, las siguientes son las áreas de ejecución lógica y de alto impacto que podemos abordar a continuación:

1.  **Desarrollo del Frontend de la Mini App de Gestión:** Con la base de datos y la autorización de personal (`STAFF_IDS`) ya implementadas, el siguiente gran paso es comenzar a construir la interfaz de usuario de la Mini App interna para que el personal gestione los trabajos (`jobs`).
2.  **Implementación de Lógica Avanzada para `/cotizar`:** Expandir el comando `/cotizar` para que inicie un flujo conversacional, recopile detalles del vehículo y del problema, y cree un nuevo registro en la tabla `jobs` con el estado `'LEAD'`, notificando al personal.
3.  **Sistema de Notificaciones para el Personal:** Implementar una funcionalidad que envíe notificaciones a un grupo de Telegram de personal (utilizando la variable `STAFF_GROUP_ID`) cada vez que se cree un nuevo `LEAD` a través de `/cotizar` o se agende una nueva cita con `/agendar`.
4.  **Implementación de Pruebas Unitarias y de Integración:** Utilizar `vitest` (ya en el proyecto) para escribir pruebas para las funciones de base de datos y los manejadores de comandos, asegurando la robustez y la salud a largo plazo del código.

Hemos concluido por hoy. El proyecto está en un estado sólido y bien documentado para continuar en nuestra próxima sesión.